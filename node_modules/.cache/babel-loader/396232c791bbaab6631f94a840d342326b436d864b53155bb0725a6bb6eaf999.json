{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _constants = require(\"./constants\");\nvar _errorCodes = require(\"./errorCodes\");\nvar _createDestructor2 = _interopRequireDefault(require(\"./createDestructor\"));\nvar _connectCallReceiver = _interopRequireDefault(require(\"./connectCallReceiver\"));\nvar _connectCallSender = _interopRequireDefault(require(\"./connectCallSender\"));\nvar _createLogger = _interopRequireDefault(require(\"./createLogger\"));\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\n/**\n * @typedef {Object} Parent\n * @property {Promise} promise A promise which will be resolved once a connection has\n * been established.\n * @property {Function} destroy A method that, when called, will disconnect any\n * messaging channels. You may call this even before a connection has been established.\n */\n\n/**\n * Attempts to establish communication with the parent window.\n * @param {Object} options\n * @param {string} [options.parentOrigin=*] Valid parent origin used to restrict communication.\n * @param {Object} [options.methods={}] Methods that may be called by the parent window.\n * @param {Number} [options.timeout] The amount of time, in milliseconds, Penpal should wait\n * for the parent to respond before rejecting the connection promise.\n * @return {Parent}\n */\nvar _default = function _default() {\n  let _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n    _ref$parentOrigin = _ref.parentOrigin,\n    parentOrigin = _ref$parentOrigin === void 0 ? '*' : _ref$parentOrigin,\n    _ref$methods = _ref.methods,\n    methods = _ref$methods === void 0 ? {} : _ref$methods,\n    timeout = _ref.timeout,\n    debug = _ref.debug;\n  const log = (0, _createLogger.default)(debug);\n  if (window === window.top) {\n    const error = new Error('connectToParent() must be called within an iframe');\n    error.code = _errorCodes.ERR_NOT_IN_IFRAME;\n    throw error;\n  }\n  const _createDestructor = (0, _createDestructor2.default)(),\n    destroy = _createDestructor.destroy,\n    onDestroy = _createDestructor.onDestroy;\n  const child = window;\n  const parent = child.parent;\n  const promise = new Promise((resolveConnectionPromise, reject) => {\n    let connectionTimeoutId;\n    if (timeout !== undefined) {\n      connectionTimeoutId = setTimeout(() => {\n        const error = new Error(`Connection to parent timed out after ${timeout}ms`);\n        error.code = _errorCodes.ERR_CONNECTION_TIMEOUT;\n        reject(error);\n        destroy();\n      }, timeout);\n    }\n    const handleMessageEvent = event => {\n      // Under niche scenarios, we get into this function after\n      // the iframe has been removed from the DOM. In Edge, this\n      // results in \"Object expected\" errors being thrown when we\n      // try to access properties on window (global properties).\n      // For this reason, we try to access a global up front (clearTimeout)\n      // and if it fails we can assume the iframe has been removed\n      // and we ignore the message event.\n      try {\n        clearTimeout();\n      } catch (e) {\n        return;\n      }\n      if (event.source !== parent || event.data.penpal !== _constants.HANDSHAKE_REPLY) {\n        return;\n      }\n      if (parentOrigin !== '*' && parentOrigin !== event.origin) {\n        log(`Child received handshake reply from origin ${event.origin} which did not match expected origin ${parentOrigin}`);\n        return;\n      }\n      log('Child: Received handshake reply');\n      child.removeEventListener(_constants.MESSAGE, handleMessageEvent);\n      const info = {\n        localName: 'Child',\n        local: child,\n        remote: parent,\n        originForSending: event.origin === 'null' ? '*' : event.origin,\n        originForReceiving: event.origin\n      };\n      const callSender = {};\n      const destroyCallReceiver = (0, _connectCallReceiver.default)(info, methods, log);\n      onDestroy(destroyCallReceiver);\n      const destroyCallSender = (0, _connectCallSender.default)(callSender, info, event.data.methodNames, destroy, log);\n      onDestroy(destroyCallSender);\n      clearTimeout(connectionTimeoutId);\n      resolveConnectionPromise(callSender);\n    };\n    child.addEventListener(_constants.MESSAGE, handleMessageEvent);\n    onDestroy(() => {\n      child.removeEventListener(_constants.MESSAGE, handleMessageEvent);\n      const error = new Error('Connection destroyed');\n      error.code = _errorCodes.ERR_CONNECTION_DESTROYED;\n      reject(error);\n    });\n    log('Child: Sending handshake');\n    parent.postMessage({\n      penpal: _constants.HANDSHAKE,\n      methodNames: Object.keys(methods)\n    }, parentOrigin);\n  });\n  return {\n    promise,\n    destroy\n  };\n};\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"names":["Object","defineProperty","exports","value","default","_constants","require","_errorCodes","_createDestructor2","_interopRequireDefault","_connectCallReceiver","_connectCallSender","_createLogger","obj","__esModule","_default","_ref","arguments","length","undefined","_ref$parentOrigin","parentOrigin","_ref$methods","methods","timeout","debug","log","window","top","error","Error","code","ERR_NOT_IN_IFRAME","_createDestructor","destroy","onDestroy","child","parent","promise","Promise","resolveConnectionPromise","reject","connectionTimeoutId","setTimeout","ERR_CONNECTION_TIMEOUT","handleMessageEvent","event","clearTimeout","e","source","data","penpal","HANDSHAKE_REPLY","origin","removeEventListener","MESSAGE","info","localName","local","remote","originForSending","originForReceiving","callSender","destroyCallReceiver","destroyCallSender","methodNames","addEventListener","ERR_CONNECTION_DESTROYED","postMessage","HANDSHAKE","keys","module"],"sources":["/Users/fabienpicard/Projects/astro-website/node_modules/penpal/lib/connectToParent.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _constants = require(\"./constants\");\n\nvar _errorCodes = require(\"./errorCodes\");\n\nvar _createDestructor2 = _interopRequireDefault(require(\"./createDestructor\"));\n\nvar _connectCallReceiver = _interopRequireDefault(require(\"./connectCallReceiver\"));\n\nvar _connectCallSender = _interopRequireDefault(require(\"./connectCallSender\"));\n\nvar _createLogger = _interopRequireDefault(require(\"./createLogger\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * @typedef {Object} Parent\n * @property {Promise} promise A promise which will be resolved once a connection has\n * been established.\n * @property {Function} destroy A method that, when called, will disconnect any\n * messaging channels. You may call this even before a connection has been established.\n */\n\n/**\n * Attempts to establish communication with the parent window.\n * @param {Object} options\n * @param {string} [options.parentOrigin=*] Valid parent origin used to restrict communication.\n * @param {Object} [options.methods={}] Methods that may be called by the parent window.\n * @param {Number} [options.timeout] The amount of time, in milliseconds, Penpal should wait\n * for the parent to respond before rejecting the connection promise.\n * @return {Parent}\n */\nvar _default = function _default() {\n  let _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      _ref$parentOrigin = _ref.parentOrigin,\n      parentOrigin = _ref$parentOrigin === void 0 ? '*' : _ref$parentOrigin,\n      _ref$methods = _ref.methods,\n      methods = _ref$methods === void 0 ? {} : _ref$methods,\n      timeout = _ref.timeout,\n      debug = _ref.debug;\n\n  const log = (0, _createLogger.default)(debug);\n\n  if (window === window.top) {\n    const error = new Error('connectToParent() must be called within an iframe');\n    error.code = _errorCodes.ERR_NOT_IN_IFRAME;\n    throw error;\n  }\n\n  const _createDestructor = (0, _createDestructor2.default)(),\n        destroy = _createDestructor.destroy,\n        onDestroy = _createDestructor.onDestroy;\n\n  const child = window;\n  const parent = child.parent;\n  const promise = new Promise((resolveConnectionPromise, reject) => {\n    let connectionTimeoutId;\n\n    if (timeout !== undefined) {\n      connectionTimeoutId = setTimeout(() => {\n        const error = new Error(`Connection to parent timed out after ${timeout}ms`);\n        error.code = _errorCodes.ERR_CONNECTION_TIMEOUT;\n        reject(error);\n        destroy();\n      }, timeout);\n    }\n\n    const handleMessageEvent = event => {\n      // Under niche scenarios, we get into this function after\n      // the iframe has been removed from the DOM. In Edge, this\n      // results in \"Object expected\" errors being thrown when we\n      // try to access properties on window (global properties).\n      // For this reason, we try to access a global up front (clearTimeout)\n      // and if it fails we can assume the iframe has been removed\n      // and we ignore the message event.\n      try {\n        clearTimeout();\n      } catch (e) {\n        return;\n      }\n\n      if (event.source !== parent || event.data.penpal !== _constants.HANDSHAKE_REPLY) {\n        return;\n      }\n\n      if (parentOrigin !== '*' && parentOrigin !== event.origin) {\n        log(`Child received handshake reply from origin ${event.origin} which did not match expected origin ${parentOrigin}`);\n        return;\n      }\n\n      log('Child: Received handshake reply');\n      child.removeEventListener(_constants.MESSAGE, handleMessageEvent);\n      const info = {\n        localName: 'Child',\n        local: child,\n        remote: parent,\n        originForSending: event.origin === 'null' ? '*' : event.origin,\n        originForReceiving: event.origin\n      };\n      const callSender = {};\n      const destroyCallReceiver = (0, _connectCallReceiver.default)(info, methods, log);\n      onDestroy(destroyCallReceiver);\n      const destroyCallSender = (0, _connectCallSender.default)(callSender, info, event.data.methodNames, destroy, log);\n      onDestroy(destroyCallSender);\n      clearTimeout(connectionTimeoutId);\n      resolveConnectionPromise(callSender);\n    };\n\n    child.addEventListener(_constants.MESSAGE, handleMessageEvent);\n    onDestroy(() => {\n      child.removeEventListener(_constants.MESSAGE, handleMessageEvent);\n      const error = new Error('Connection destroyed');\n      error.code = _errorCodes.ERR_CONNECTION_DESTROYED;\n      reject(error);\n    });\n    log('Child: Sending handshake');\n    parent.postMessage({\n      penpal: _constants.HANDSHAKE,\n      methodNames: Object.keys(methods)\n    }, parentOrigin);\n  });\n  return {\n    promise,\n    destroy\n  };\n};\n\nexports.default = _default;\nmodule.exports = exports.default;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}